#+title: WEIR Database Documentation
#+MACRO: comments_description how is this actually working
#+OPTIONS: tex:imagemagick author:nil
#+bibliography: wicst_references.bib
#+cite_export: csl ~/Zotero/styles/chicago-author-date.csl

#+ATTR_ODT: :width 800 :height 300 :anchor page
[[file:img/bob_weir.jpg]]

* WICST Experimental Design
The core experiment information is held in 3 tables: [[*wicst.plots][wicst.plots]], [[*wicst.rotations][wicst.rotations]], and
* Accessing the database
#+begin_src R
# Ensure you are running R >= 4.0.0
con <- DBI::dbConnect(odbc::odbc(),
                      driver = “ODBC Driver 18 for SQL Server”,
                      server = “carrington.doit.wisc.edu”,
                      uid = “USERNAME”,
                      pwd = rstudioapi::askForPassword("Database Password"),
                      database = “WEIR”,
                      TrustServerCertificate = “yes”,
                      port = 1433)

# slightly shorter connection string using “dsn”
con <- DBI::dbConnect(odbc::odbc(),
                      dsn = “carrington”, # name of DSN specified
                      uid = “USERNAME”,
                      pwd = rstudioapi::askForPassword("Database Password"))

# read a table from
DBI::dbReadTable(con, DBI::Id(schema = “wicst”, table = “plantings”))
#+end_src

* Table Documentation
** WICST Schema
*** wicst.biomassingdetails
This table holds additional details of biomass sampling with "non-essential" information, supplemental to the [[*wicst.biomassings][=wicst.biomassings=]] table. The information collected over the years for sampling has changed, thus the information in this table is largely dependent on the year and process of sample collection.
#+ATTR_ODT: :rel-width 100
| Column Name            | Type         | Description                                                                                                                                    |
|------------------------+--------------+------------------------------------------------------------------------------------------------------------------------------------------------|
| =biomassing_id= (PK, FK) | VARCHAR<255> | ID for biomassing observation                                                                                                                  |
| =biomass_length=         | FLOAT<8>     | Length of area biomassed, if known. =biomass_area= will normally be =biomass_length= * =biomass_width=, unless =biomass_area= is manually overwritten. |
| =biomass_width=          | FLOAT<8>     | Width of area biomassed, if known. =biomass_area= will normally be =biomass_length= * =biomass_width=, unless =biomass_area= is manually overwritten.  |
| =rrl_id=                 | FLOAT<8>     | Rock River Lab ID of biomassing sample                                                                                                         |
| =bucket_lbs=             | FLOAT<8>     | Weight of the bucket used to assist in collecting biomass                                                                                      |
| =comments=               | VARCHAR<255> | Miscellaneous comments about observation. Different comments delimited by "\vert"                                                                  |
| =bag_weight=             | FLOAT<8>     | Weight of the bag used to assist in collecting biomass. Unknown if bag weight was before or after drying sample.                               |
| =dry_weight_w_bag=       | FLOAT<8>     | Weight of biomassing bag with the dried sample                                                                                                 |
| =wet_weight_w_bag=       | FLOAT<8>     | Weight of biomassing bag with the wet sample                                                                                                   |
| =wet_bag_weight=         | FLOAT<8>     | Weight of the bag used to assist in collecting biomass before drying the sample.                                                               |
| =dry_bag_weight=         | FLOAT<8>     | Weight of the bag used to assist in collecting biomass after drying the sample.                                                                |
| =wet_weight_no_bag=      | FLOAT<8>     | Weight of biomass not including the weight of the bag, before drying.                                                                          |
| =dry_weight_no_bag=      | FLOAT<8>     | Weight of biomass not including the weight of the bag, after drying.                                                                           |
| =stubble_inches=         | FLOAT<8>     | How many inches of stubble is left after taking the biomassing sample.                                                                         |
| =tenday=                 | FLOAT<8>     | Numeric estimate of how many 10 day periods since the beginning of season the biomassing was taken.                                            |
| =cycle=                  | FLOAT<8>     | Estimate of how many growing cycles since beginning of season the biomassing was taken.                                                        |
**** Details
- cycle :: For biomassings on pasture, cycle gives an estimate of when in the season the biomassing was taken. This value is used to help estimate the total forage availability. Each cycle is roughly considered 30 days.
- tenday :: For biomassings on pasture, tenday gives a finer estimate of when in the season the biomassing was taken, numerically, in 10 day increments starting early-May to October depending on the year. This serves a similar purpose to pasture cycle, but is used in the calculation of forage availability. See
- =stubble_inches= :: In order to estimate forage availability more consistently across different years, the stubble height can be used to adjust the weight of the biomass collected.
*** wicst.biomassings
This table holds every measured and sampled observation from the plot with the purposes of estimating an amount of biomass on the field without fully harvesting all the product off the field. Both hand and machine sampled observations are included, such as sampling from quadrats and undercuts.
#+ATTR_ODT: :rel-width 100
| Column Name            | Type         | Description                                                 |
| =biomassing_id= (PK, FK) | VARCHAR<255> | ID for biomassing observation                               |
| =yielding_type=          | VARCHAR<255> | Type of yield                                               |
| =biomass_date=           | DATETIME     | Date of biomassing                                          |
| =plot_id=                | VARCHAR<255> | ID of plot biomassing was taken                             |
| =coordinate=             | VARCHAR<255> | Area of plot-section biomassing was taken                   |
| =method=                 | VARCHAR<255> | Technique of how biomassing was taken                       |
| =biomass=                | VARCHAR<255> | The product that was taken during biomassing                |
| =component=              | VARCHAR<255> | Portion of plant biomassed                                  |
| =cut=                    | FLOAT<8>     | How many times has a product been cut from this plot before |
| =biomass_area=           | FLOAT<8>     | Area in square feet the biomass was taken                   |
| =percent_moisture=       | FLOAT<8>     | Water moisture content of biomassed sample                  |
| =biomass_grams=          | FLOAT<8>     | Amount of biomass taken in grams                            |
**** Data Details
- =biomass=  ["quack" | "rye" | "oat" | "wheat" | "weed" | "berseem clover" | "residue" | "alfalfa" | "clover" | "pasture"] ::
- =yielding_type= :: type of yield in this table is all biomassing, but needed for checking exclusive typing.
  + biomassing - taking a measurement with the goal of inferring yield or mass from larger area. Observations are generally clearly one or the other, but small harvests may conceptually be similar. For such cases, biomassings should be limited to be less than 1000 sq ft.
  + harvesting - all product is taken off the field
- =method= ["quadrat" | "undercutting" | "exclosure"] :: Technique of how biomassing was taken
  + /quadrat/ - taking a biomass by manually sampling above ground from small area, normally within a quadrat
  + /undercutting/ - drawing blade through the soil, for either shoots or roots. This practice was more common between 2014-2019, and stopped in preference for quadratting for less soil disturbance
- =component= ["roots" | "shoots"] :: the portion of the plant that was biomassed.
  + /roots/ - underground portion
  + /shoots/ - above ground portion
*** wicst.carbon                                                  :soil_archive:
Table holding soil organic carbon measurements for WICST.
| Column Name         | Type         | Description                                                                 |
|---------------------+--------------+-----------------------------------------------------------------------------|
| =year=                | FLOAT<8>     | year of soil sample                                                         |
| =plot_id=             | VARCHAR<255> | ID of plot soil samples were taken from                                     |
| =section=             | VARCHAR<255> | Location within plot soil samples were taken                                |
| =coordinate=          | VARCHAR<255> | Location within plot-section soil samples were taken                        |
| =depth=               | VARCHAR<255> | The targeted sampling depth category                                        |
| =min_depth_inch=      | FLOAT<8>     | Actual minimum limit of soil sampling depth in inches                       |
| =max_depth_inch=      | FLOAT<8>     | Actual maximum limit of soil sampling depth in inches                       |
| =cn_method=           | VARCHAR<255> | Method used to quantify carbon and nitrogen                                 |
| =number_composited=   | FLOAT<8>     | Number of soil samples that have been composited for observation            |
| =nit=                 | FLOAT<8>     | Nitrogen percentage measured                                                |
| =nit_kriged=          | FLOAT<8>     | kriged estimate of nitrogen as percentage                                   |
| =nit_kriged_variance= | FLOAT<8>     | variance of kriged estimate of nitrogen                                     |
| =soc=                 | FLOAT<8>     | Soil organic carbon percentage                                              |
| =soc_kriged=          | FLOAT<8>     | kriged estimate of soil organic carbon as percentage                        |
| =soc_kriged_variance= | FLOAT<8>     | variance of kriged estimate of soil organic carbon                          |
| =soc_equipment=       | VARCHAR<255> | Equipment used for SOC measurement                                          |
| =bulk_density_g_cm3=  | FLOAT<8>     | Bulk density in =g/cm^3=                                                      |
| =soc_mg_ha=           | FLOAT<8>     | soil organic carbon in =megagrams/hectare=                                    |
| =soc_mg_ha_method=    | VARCHAR<255> | method of calculating =soc_mg_ha=                                             |
| =esm_reference=       | VARCHAR<255> | Free text description for conserved reference mass in =soc_mg_ha= calculation |
**** Data Details
- =coordinate= ["south" | "north" | "center"] ::
- =depth= ["0-6 in" | "6-12 in" | "0-12 in" | "12-24 in" | "24-36 in"] ::
  Depth categorizations of soil sampling observations. These represent the intended soil sample, even if full depth was not achieved
- =min_depth_inch= ::
  When target sampling depth was not obtained, these numbers provide a more accurate interval for soil collected
- =max_depth_inch= ::
  When target sampling depth was not obtained, these numbers provide a more accurate interval for soil collected
- =number_composited= ::
  Some observations are composited from multiple samples from the field.
  - /0/ - observation is not representative of any soil samples, for example for kriged estimates
  - /1+/ - when 1 or greater, the number of samples composited in the field for the observation
- =soc= ::
  The =soc= column refers to the mass % carbon of the soil sample, as determined by dry combustion using a Flash EA 1112 CN Automatic Elemental Analyzer. %C was considered equivalent to %SOC for these soils. Samples for %SOC analysis were collected by combining 3 samples taken 19 cm apart (0, 19, and 38 cm). This was done to ensure that samples were collected in-row, between-row, and at an intermediate location in all of the maize plots, to account for variation in SOC between rows of maize.
  - See [cite/t:@dietzSoilCarbonMaintained2024]
- =soc_kriged= ::
  see =nit_kriged=
- =nit_kriged= ::
  Bulk soils were sampled on a 30 x 30 grid in 1989 as described in [cite/t:@dietzSoilCarbonMaintained2024] and segmented into 0-15, 15-30, 30-60, and 60-90 cm depth increments. Samples were analyzed for N (and C) using dry combustion. Bulk soil N (g N / 100 g soil) was interpolated using a kriging process similar to that described in [cite/t:@dietzSoilCarbonMaintained2024] for C interpolation. Briefly, spherical variogram models using were fitted to each depth separately using the gstat package in R. Starting values for nugget, psill, and range were determined by visual inspection of semi-variograms. Due to low spatial autocorrelation in the 30-60 and 60-90 cm depths, the variogram models did not fully meet convergence criteria. However, visual inspection of the model vs. semi-variogram indicated that the model fits were acceptable. The low spatial autocorrelation in the 30-60 cm and 60-90 cm depths results in high variance and limited range of estimated values. However, for N balance purposes, the high variance of N estimates is likely acceptable.
  - See =WICST_N_kriging_graphs_2024-01-14.pdf= for graphs of the kriging process.
  - See also [cite/t:@gralerSpatioTemporalInterpolationUsing2016] kriging details in R
- =cn_method= ["dry combustion" | "mid infrared reflectance"] ::
  - /dry combustion/ - considered the standard for elemental analysis
  - /mid-infrared reflectance/ - predicts SOC concentration based on absorbed mid-infrared light. Cheaper but less accurate.
- =soc_mg_ha_method= ["depth based" | "equivalent soil mass"] ::
  - /depth based/ - uses the soil depth interval to estimate soil mass, multiplying by bulk density and soil carbon percentage for carbon stock
  - /equivalent soil mass/ - To determine C stocks, rather than using depth from surface, we used cumulative mineral soil mass from the surface as it is a reference system that remains stable over time (i.e., not impacted by changes in bulk density or changes in organic matter). This "equivalent soil mass" or ESM method accounts for compaction, expansion, and addition or loss of organic matter, ensuring the same section of the soil profile is considered each time. For this dataset, these calculations were performed using R code provided by [cite/t:@vonhadenSoilsDirtyLittle2020] with the 1989 %SOC and BD for each sampling location (e.g. subplot within each plot) as the baseline.
    - See [cite/t:@vonhadenSoilsDirtyLittle2020] a clear and thorough explanation of ESM and its importance.
*** wicst.canopeo
Canopeo is an app used for estimating green canopy cover, this table hold relevant information for such
| Column Name         | Type         | Description                                                  |
| =canopeo_id= (PK, FK) | VARCHAR<255> | ID for canopeo observation                                   |
| =coverage_date=       | DATETIME     | Date the canopeo observation was made                        |
| =plot=                | VARCHAR<255> | The plot that the canopeo observation is made                |
| =coordinate=          | VARCHAR<255> | location within plot-section the canopeo observation is made |
| =biomass=             | VARCHAR<255> | Description of biomass(es) contributing to the canopy cover  |
| =percent_cover=       | FLOAT<8>     | The percentage of area the canopy is covered                 |
**** Details
- =percent_cover= [0-100] ::
- =biomass= :: Multiple biomasses may contribute to the canopy cover, this text field is currently unstructured.
*** wicst.canopeodetails
| Column Name | Type         | Description                                        |
| =canopeo_id=  | VARCHAR<255> | ID for canopeo observation                         |
| =comments=    | VARCHAR<255> | Additional comments describing canopeo observation |
*** wicst.directlossdetails
| Column Name   | Type | Description                                               |
| =directloss_id= |      | ID of direct loss observed                                |
| =loss_width=    |      | Width of loss area                                        |
| =loss_length=   |      | Length of loss area                                       |
| =loss_reason=   |      | Reason for loss                                           |
| =loss_comments= |      | Additional comments regarding the direct loss observation |
**** Details
- =loss_width= :: =wicst.directlosses.loss_area= should normally be =loss_width= * =loss_length=, but not always because =loss_area= may have been manually overridden or modified. =loss_width= was sourced from excel sheets either explicitly or implicitly based on area calculations. Width is considered less than length if unlabelled.
- =loss_length= :: =wicst.directlosses.loss_area= should normally be =loss_width= * =loss_length=, but not always because =loss_area= may have been manually overridden or modified. =loss_length= was sourced from excel sheets either explicitly or implicitly based on area calculations. Width is considered less than length if unlabelled.
*** wicst.directlosses
| Column Name   | Type         | Description                                          |
| =directloss_id= | VARCHAR<255> | ID of direct loss observed                           |
| =harvesting_id= | VARCHAR<255> | ID of harvesting that the direct loss applies to     |
| =loss_area=     | FLOAT<8>     | Area of plot that harvest for which harvest was lost |
*** wicst.feedings
| Column Name                 | Type | Description                                                   |
| =year=                        |      | Year of feeding observation                                   |
| =seasonal_sum_grain_per_head= |      | Total amount of grain fed to each heifer across entire season |
**** Data Details
*** wicst.fertilizings
| Column Name      | Type         | Description                                      |
| =fertilizing_date= | DATETIME     | Date of fertilizing                              |
| =plot_id=          | VARCHAR<255> | ID of plot where fertilizer was applied          |
| =fertilizer_type=  | VARCHAR<255> | Common name of fertilizer                        |
| =n=                | FLOAT<8>     | Nitrogen content of N                            |
| =p2o5=             | FLOAT<8>     | Phosphorus pentoxide of fertilizer               |
| =k2o=              | FLOAT<8>     | Potassium oxide content of fertilizer            |
| =s=                | FLOAT<8>     | Sulfur content of fertilizer                     |
| =ca=               | FLOAT<8>     | Calcium content of fertilizer                    |
| =mg=               | FLOAT<8>     | Magnesium content of fertilizer                  |
| =rate=             | FLOAT<8>     | Fertilizer application rate                      |
| =rate_unit=        | VARCHAR<255> | Unit the =rate= is recorded in                     |
| =comments=         | VARCHAR<255> | Additional comments about fertilizer application |
**** Data details
*** wicst.grazings
| Column Name | Type         | Description                                |
| =year=        | FLOAT<8>     | Year of grazing observation                |
| =animal_id=   | FLOAT<8>     | ID of grazing animal                       |
| =animal_type= | VARCHAR<255> | Type of grazing animal                     |
| =on_date=     | DATETIME     | Date animal started grazing for the season |
| =off_date=    | DATETIME     | Date animal stopped grazing for the season |
| =start_lbs=   | FLOAT<8>     | Beginning weight of animal before grazing  |
| =end_lbs=     | FLOAT<8>     | Ending weight of animal after grazing      |
**** Data details
- =animal_type= [heifer | steer] :: The type of grazing animal
*** wicst.harvestingdetails
| Column Name       | Type         | Description                                                                                                      |
| =harvesting_id=     | VARCHAR<255> | ID of harvesting observation                                                                                     |
| =harvest_length=    | FLOAT<8>     | Length of harvest area                                                                                           |
| =harvest_width=     | FLOAT<8>     | Width of harvest area                                                                                            |
| =rrl_id=            | FLOAT<8>     | Rock River Lab ID of harvesting sample                                                                           |
| =comments=          | VARCHAR<255> | Additional comments about harvest                                                                                |
| =bag_weight=        | FLOAT<8>     | Weight of the bag used to assist in collecting biomass. Unknown if bag weight was before or after drying sample. |
| =wet_weight_w_bag=  | FLOAT<8>     | Weight of harvest bag with the wet sample                                                                        |
| =dry_weight_w_bag=  | FLOAT<8>     | Weight of harvest bag with the dried sample                                                                      |
| =dry_weight_no_bag= | FLOAT<8>     | Weight of the harvest sample not including the weight of the bag, after drying.                                  |
| =num_bales=         | FLOAT<8>     | Number of bales of harvest product                                                                               |
| =wet_bag_weight=    | FLOAT<8>     | Weight of the bag used to collect harvest sample before drying the sample.                                       |
| =wet_weight_no_bag= | FLOAT<8>     | Weight of the biomass not including the weight of the bag, before drying.                                        |
| =wagon_weight=      | FLOAT<8>     | Weight of the wagon used to collect harvest                                                                      |
| =wagon_color=       | VARCHAR<255> | Color of the wagon used to collect harvest                                                                       |
| =trailer_weight=    | FLOAT<8>     | Weight of the trailer used to collect harvest                                                                    |
| =dry_bag_weight=    | FLOAT<8>     | Weight of the bag used to collect harvest sample after drying the sample                                         |
| =bushel_lbs=        | FLOAT<8>     | Weight of a single bushel of product in pounds.                                                                  |
| =moisture_source=   | VARCHAR<255> | How and where was the water moisture content evaluated                                                           |
| =tenday=            | FLOAT<8>     | Numeric estimate of how many 10 day periods since the beginning of season the harvest was taken.                 |
| =cycle=             | FLOAT<8>     | Estimate of how many growing cycles since beginning of season the biomassing was taken.                          |
*** wicst.harvestings
| Column Name         | Type         | Description                                      |
| =harvesting_id=       | VARCHAR<255> | ID of harvesting observation                     |
| =yielding_type=       | VARCHAR<255> | Type of yield observation                        |
| =harvest_date=        | DATETIME     | Date of harvest                                  |
| =plot_id=             | VARCHAR<255> | ID of plot harvest was taken                     |
| =product=             | VARCHAR<255> | Category of harvested product                    |
| =product_description= | VARCHAR<255> | Description of harvested product                 |
| =harvest_area=        | FLOAT<8>     | Amount of area that was harvested in square feet |
| =percent_moisture=    | FLOAT<8>     | Moisture content of harvested product            |
| =harvest_lbs=         | FLOAT<8>     | Weight of harvested product in pounds            |
**** Data Details
*** wicst.limings
| Column Name | Type         | Description                     |
| =date=        | DATETIME     | Date of lime application        |
| =plot_id=     | VARCHAR<255> | ID of plot the lime was applied |
| =grading=     | VARCHAR<255> | Lime grade                      |
| =rate=        | FLOAT<8>     | Rate the lime was applied       |
| =rate_unit=   | VARCHAR<255> | Unit the =rate= is recorded     |
*** wicst.losses
| Column Name   | Type         | Description                           |
| =loss_id=       | VARCHAR<255> | ID of loss observation                |
| =loss_type=     | VARCHAR<255> | Type of loss observation              |
| =harvesting_id= | VARCHAR<255> | ID of harvesting that loss is applied |
*** wicst.manurings
| Column Name | Type         | Description                                  |
| =plot_id=     | VARCHAR<255> | ID of plot manure was applied                |
| =manure_date= | DATETIME     | Date manure was applied                      |
| =source=      | VARCHAR<255> | Source from which the manure originated      |
| =type=        | VARCHAR<255> | The material form of the manure              |
| =method=      | VARCHAR<255> | How was the manure applied to the plot       |
| =rate=        | FLOAT<8>     | Rate of manure application                   |
| =rate_unit=   | VARCHAR<255> | Unit the =rate= is recorded                    |
| =comments=    | VARCHAR<255> | Additional comments about manure application |
*** wicst.plantings
| Column Name      | Type         | Description                                                                                                        |
| =planting_date=    | DATETIME     | Date crop was seeded                                                                                               |
| =plot_id=          | VARCHAR<255> | ID of plot where the crop was planted                                                                              |
| =crop=             | VARCHAR<255> | Crop that was planted                                                                                              |
| =source=           | VARCHAR<255> | Source of crop seed                                                                                                |
| =variety=          | VARCHAR<255> | Variety of seed that was planted                                                                                   |
| =attribute_listed= | VARCHAR<255> | An identifying attribute listed by manufacture, which in addition to variety identifies the specific seed product. |
| =rate=             | FLOAT<8>     | Rate of planting                                                                                                   |
| =rate_unit=        | VARCHAR<255> | Unit the =rate= is recorded                                                                                          |
| =type=             | VARCHAR<255> | The type of planting strategy used.                                                                                |
| =method=           | VARCHAR<255> | How was the seed put into the ground                                                                               |
| =comments=         | VARCHAR<255> | Additional comments about the seed plantings                                                                       |
*** wicst.plots
| Column Name  | Type         | Description                                                         |
| =plot_id=      | VARCHAR<255> | ID of plots in WICST                                                |
| =site_id=      | VARCHAR<255> | ID of sites plot belongs to                                         |
| =block=        | FLOAT<8>     | Replicate number plot belongs to from initial RCBD randomization    |
| =treatment_id= | FLOAT<8>     | ID of treatment the plot was assigned in initial RCBD randomization |
*** wicst.rotations
| Column Name      | Type         | Description                                       |
| =rotation_id= (PK) | VARCHAR<255> | ID of the combination of system and phase         |
| =system_id=        | VARCHAR<255> | ID of the cropping system                         |
| =phase=            | FLOAT<8>     | Crop rotation phase                               |
| =crop=             | FLOAT<8>     | Primary crop for the system and phase combination |
**** Data Details
- =phase= [1-4] :: phase of the crop rotation. The number of phases depend on the assigned cropping system. Phase 1 is always corn.
- =crop= [C | SB | W/CL | A | Ai | Aii | O/A | P] :: Multiple crops may be planted but each phase of the cropping systems is coded with a "main" crop.
  + /C/ - corn
  + /SB/ - soybean
  + /W/CL/ - wheat with clover cover crop
  + /A/ - direct seeded alfalfa
  + /Ai/ - established alfalfa 1
  + /Aii/ - established alfalfa 2
  + /O/A/ - oats and alfalfa
  + /P/ - pasture plots
*** wicst.sites
The sites holds information relevant to where research plots are and experiments are happening. WICST has two research sites, Arlington and Lakeland.
| Column Name  | Type         | Description                      |
| =site_id= (PK) | VARCHAR<255> | ID of the research site          |
| =site_name=    | VARCHAR<255> | Common name of the research site |
**** Data Details
- =site_id= [ARL | LAC] :: Three letter code for research site. Only Arlington research station is currently active.
*** wicst.soils                                                   :soil_archive:
Table holding information related to soil fertility. Routine fertility, and deep core samples are included here.
| Column Name | Type         | Description                                          |
|-------------+--------------+------------------------------------------------------|
| =year=        | FLOAT<8>     | year of soil sample                                  |
| =plot_id=     | FLOAT<8>     | ID of plot soil samples were taken from              |
| =section=     | VARCHAR<255> | Location within plot soil samples were taken         |
| =coordinate=  | VARCHAR<255> | Location within plot-section soil samples were taken |
| =season=      | VARCHAR<255> | season soil sample was taken                         |
| =soil_date=   | DATETIME     | When the soil sample was taken, if known             |
| =soil_tier=   | VARCHAR<255> | type of soil fertility                               |
| =depth=       | VARCHAR<255> | Range of soil depth used for soil analysis           |
| =ph=          | FLOAT<8>     | pH of soil                                           |
| =om=          | FLOAT<8>     | Organic Matter Percentage                            |
| =p=           | FLOAT<8>     | Soil Test Phosphorus in ppm                          |
| =k=           | FLOAT<8>     | Soil Test Potassium in ppm                           |
| =ca=          | FLOAT<8>     | Calcium                                              |
| =mg=          | FLOAT<8>     | Magnesium                                            |
| =cec=         | FLOAT<8>     | Cation Exchange Capacity                             |
| =b=           | FLOAT<8>     | Boron                                                |
| =mn=          | FLOAT<8>     | Manganese                                            |
| =z=           | FLOAT<8>     | Zinc                                                 |
| =s=           | FLOAT<8>     | Sulfur                                               |
| =cu=          | FLOAT<8>     | Copper                                               |
| =fe=          | FLOAT<8>     | Iron                                                 |
| =bph=         | FLOAT<8>     | Buffer pH                                            |
| =nit_real=    | FLOAT<8>     | Nitrogen in =lbs/acre=                                 |
| =nit_est=     | FLOAT<8>     | Estimated Nitrogen =lbs/acre=                          |
| =lab_source=  | VARCHAR<255> | Where the soil was analyzed                          |
| =comments=    | VARCHAR<255> | comments about soil nutrient observations            |
**** Data Details
- =soil_tier= [routine fertility | fall nitrates | deep fertility] :: What type of soil fertility test and what soil source
- =depth= [0-6 in | 6-12 in | 0-12 in | 12-24 in | 24-36 in] :: What range of depth did the soil data come from.
  - This should be the targeted soil horizon for sampling that the observations represent
  - Routine fertility should be 0-6 in in depth
  - Fall nitrates should have three target depths =0-12 in=, =12-24 in=, =24-36 in=.
- =lab_source= :: The location where the analytic soil tests done.
- =soil_tier= [ fall nitrates | deep fertility | routine fertility ] :: Type of soil sample
  Each soil sample has a set of target depths, see data details for =depth=
  - /fall nitrates/ - assessment of nitrate in 1 ft soil intervals during the fall
  - /deep fertility/ - measurements from deep sample cores
  - /routine fertility/ - recurring measurements of soil nutrients
- =nit_est= ::
  NO3-N in the soil estimated by lab. Estimates for =24-36 in= depth samples are estimated from 1 and 2 ft samples.
- season [fall] :: season of soil sampling
  Exact dates for soil samples are not complete, but season of soil sample sufficient for estimate of time when backfilling data
- comments :: Additional comments about soil observations. Comments are in the format 'source: "comment"', and delimited by \vert.
*** wicst.systematiclossdetails
| Column Name                | Type         | Description                                      |
| =systematicloss_id= (PK, FK) | VARCHAR<255> | ID of systematic loss observation                |
| =assessment_total_area=      | FLOAT<8>     | Total area assessed for losses in square feet    |
| =assessment_loss_area=       | FLOAT<8>     | Area considered as loss in square feet           |
| =assessment_loss_length=     | FLOAT<8>     | Length of area considered as loss in feet        |
| =assessment_loss_rows=       | FLOAT<8>     | Number of rows considered as loss in plot        |
| =sysloss_location=           | VARCHAR<255> | Description of where the systematic loss was     |
| =sysloss_comments=           | VARCHAR<255> | Comments describing the systematic loss observed |
*** wicst.systematiclosses
| Column Name                | Type         | Description                                            |
| =systematicloss_id= (PK, FK) | VARCHAR<255> | ID of systematic loss observation                      |
| =harvesting_id=              | VARCHAR<255> | ID of harvest the systematic loss should be applied to |
| =loss_fraction=              | FLOAT<8>     | Proportion of harvest that was lost                    |
| =loss_category=              | VARCHAR<255> | Categorical reason of systematic loss                  |
*** wicst.systems
| Column Name    | Type         | Description                           |
| =system_id= (PK) | FLOAT<8>     | ID of cropping system                 |
| =description=    | VARCHAR<255> | Common description of cropping system |
*** wicst.tillings
| Column Name      | Type         | Description                              |
|------------------+--------------+------------------------------------------|
| =tillings_id= (PK) | INT          | ID of tilling                            |
| =tilling_date=     | DATETIME     | Date of tilling event                    |
| =plot_id=          | VARCHAR<255> | ID of plot                               |
| =type=             | VARCHAR<255> | Level of tilling intensity               |
| =implement=        | VARCHAR<255> | Category of tilling                      |
| =modifier=         | VARCHAR<255> | Modifiers attached to implement          |
| =timing=           | VARCHAR<255> | Timing of tilling event                  |
| =passes=           | FLOAT<8>     | Number of passes with implement          |
| =company=          | VARCHAR<255> | Company of implement                     |
| =equipment=        | VARCHAR<255> | Name of equipment from company           |
| =depth=            | FLOAT<8>     | Depth of tilling (inches)                |
| =speed=            | FLOAT<8>     | Speed tilling implement was driven (mph) |
**** Data Details
:PROPERTIES:
:TABLE_EXPORT_FORMAT: orgtbl-to-csv
:END:
- =type= ["field prep" | "primary" | "secondary" | "tertiary"] ::
  some types of implements can exist in multiple categories depending on how it's used. Often the type of tillage is determined by the implement used, but there are some implements that exist in multiple categories. There are also no standardized definitions for what is considered primary, secondary and tertiary. There is also some ambiguity in how implements are used with modifiers that may change the type of tilling intensity. There are no strict checks for this table, only convention to follow.
  - /field prep/ - often a necessary precursor to tilling involving getting rid of previous crop residue. It's not strictly speaking a type of "tilling", but we decided to track the data here because stalk chopping events were often logged similarly to tilling practices.
  - /primary/ - deep mechanical disturbance of the soil, meant to bury crop residue and loosen compacted soil layers.
  - /secondary/ - breaks down soil clods and prepares the seedbed for planting with leveling, often a follow-up to primary tillage, or the only tillage before planting if primary tilling not deemed necessary and too much soil disturbance.
    + disk and field digger implements can both be considered both primary and secondary
  - /tertiary/ - shallow tillage pass that creates a smooth seedbed, managing shallow weeds, and making finer soils
  For reference, these are the previous categories of implements in the database currently:
  | implement        | type                 |
  |------------------+----------------------|
  | stalk chopper    | field prep           |
  | chisel           | primary              |
  | disk-chisel      | primary              |
  | moldboard        | primary              |
  | vertical-till    | primary              |
  | disk             | primary or secondary |
  | field digger     | primary or secondary |
  | strip-till       | secondary            |
  | culti-packer     | secondary            |
  | drag-harrow      | secondary            |
  | field cultivator | secondary            |
  | vertical-till    | secondary            |
  | ridge hiller     | tertiary             |
  | rotary hoe       | tertiary             |
  | row cultivator   | tertiary             |
  | tine weeder      | tertiary             |

  | implement        | type                 |
  |------------------+----------------------|
  | stalk chopper    | field prep           |
  | chisel           | primary              |
  | disk             | primary or secondary |
  | disk-chisel      | primary or secondary |
  | field digger     | primary or secondary |
  | moldboard        | primary              |
  | strip-till       | primary or secondary |
  | vertical-till    | primary              |
  | culti-packer     | secondary            |
  | drag-harrow      | secondary            |
  | field cultivator | secondary            |
  | tine weeder      | secondary            |
  | vertical-till    | secondary            |
  | ridge hiller     | tertiary             |
  | rotary hoe       | tertiary             |
  | row cultivator   | tertiary             |
  | tine weeder      | tertiary             |
- =implement= ["stalk chopper" | "chisel" | "disk" | "disk-chisel" | "field digger" | "moldboard" | "strip-till" | "vertical-till" | "culti-packer" | "drag-harrow" | "field cultivator" | "tine weeder" | "ridge hiller" | "rotary hoe" | "row cultivator" | "tine weeder" ] ::
  There is ambiguity in past labeling of implements, and even within the farming community the naming is not standardized, we try to record the closest implement, while respecting the choices of past naming.
  [Some AI generated definitions]
  - /stalk chopper/ - A residue-management implement that chops standing crop stalks (e.g., corn) into small pieces to accelerate decomposition and prevent interference with subsequent tillage.
  - /chisel/ - A primary tillage tool with sturdy shanks that penetrate deep into the soil to break up compaction layers without fully inverting the soil, leaving a rough, loose seedbed.
  - /disk/ - A secondary tillage implement composed of concave steel disks arranged in gangs; it slices and mixes surface soil, breaks clods, and incorporates residue to prepare a smoother seedbed.
  - /disk-chisel/ -  A combination tool with chisel shanks up front (for deep loosening) followed by disk gangs (for residue cutting and clod breaking), merging primary and secondary tillage in one pass.
  - /field digger/ – A light, shallow tillage implement (sometimes called a “dirt hook” or “field cultivator-hoe”) used to loosen surface soil and uproot weeds without deep disturbance. There is some inconsistency with usage field digger and field cultivator in past years, which is preserved here for future users to interpret. "Quack digger" is considered a field digger.
  - /moldboard/ – A classic primary tillage plow that inverts soil completely, burying crop residue and leveling the surface but leaving large clods requiring secondary tillage. Not so common on our plots now.
  - /strip-till/ – A conservation tillage tool that tills narrow strips where the seed row will be, leaving the inter-row soil undisturbed; it conserves moisture and residue between rows while preparing a warm, loose seedbed in each strip.
  - /vertical-till/ – A tillage approach using vertical-cutting blades (no rear rolling or mixing) that slice residue and fracture soil vertically, reducing compaction while leaving much residue on the surface to protect soil. "turbo-till" should be identified as "vertical-till"
  - /culti-packer/ – A finishing implement consisting of corrugated or cleated rollers that firm and smooth the seedbed after tillage, helping ensure consistent seed-to-soil contact and reducing moisture loss. "Culti-mulchers" should be labeled as culti-packers
  - /drag-harrow/ – A lightweight, spring-tooth harrow dragged behind a tractor to break small clods, level minor ridges, and gently smooth the soil surface before planting or after emergence.
  - /field cultivator/ – A toothed tillage tool used after primary tillage to further break clods, mix soil, and uproot shallow weeds; it works at moderate depth (2–6 inches) to create a workable seedbed. "Soil-Finisher" should be labeled as a field cultivator.
  - /tine weeder/ – A shallow, narrow-tine implement that “rakes” the soil surface to uproot small weeds between crop rows or broadcast-seeded fields, operating at very low depth to avoid disturbing crop roots.
  - /ridge hiller/ – An implement with angled shovels or disks designed to form raised ridges (beds) by pushing soil toward the center, helps improve drainage and root development.
  - /rotary hoe/ – A wheel-type hoe with curved, spike-toothed wheels that lightly break crusts and uproot tiny weeds in early-emerging crops without significantly disturbing the growing plants.
  - /row cultivator/ – A steerable or adjustable-barbed implement that runs between crop rows, using spring teeth or sweeps to uproot weeds and aerate the soil without harming the crop plants.
- =modifier= ["no-till with sweeps" | "s-tine" | "sweep" | "twisted shank"] ::
- =timing= ["emergence" | "post-plant" | "post-replant" | "pre-emerge" | "pre-plant"] :: micro timing of tilling
  Since tilling may occur the same day as planting or replanting, the timing relative to these important events is also documented.
- =company= ["Case IH" | "AGCO" | "Balzer" | "Blu-Jet" | "Brillion" | "John Deere" | "Krause" | "Sunflower" | "Wil-Rich" | "Yetter"] ::
  Ideally the equipment and implement will eventually be replaced with an equipment ID and supported with its own table, that way tooling used will have full information, but in the past, sometimes only the company of the equipment is known, and even then for only about <5% of the existing data.
- =equipment= ["15 ft" | "200" | "335" | "4511" | "5035" | "7400" | "980"] ::
  Equipment should be interpreted in tandem with the company to be identifying.
*** wicts.treatments
| Column Name       | Type     | Description                                        |
|-------------------+----------+----------------------------------------------------|
| =treatment_id= (PK) | FLOAT<8> | ID of assigned treatment                           |
| =system_id= (FK)    | FLOAT<8> | Cropping system the assigned treatment belongs     |
| =start_year=        | FLOAT<8> | First year after 1989 that is not filler corn      |
| =start_crop=        | FLOAT<8> | First crop planted after filler corn on =start_year= |
*** wicst.yieldings
| Column Name      | Type         | Description                                    |
| =yielding_id= (PK) | VARCHAR<255> | ID of the yield observation                    |
| =yielding_type=    | VARCHAR<255> | Cropping system the assigned treatment belongs |
** EI Schema
*** ei.biogeo                                                     :soil_archive:
| Column Name                  | Type         | Description                                                                                                                   |
|------------------------------+--------------+-------------------------------------------------------------------------------------------------------------------------------|
| =year=                         | FLOAT<8>     | year                                                                                                                          |
| =seq_id=                       | FLOAT<8>     | sequence for rock river lab samples submission                                                                                |
| =plot=                         | VARCHAR<255> | main plot number                                                                                                              |
| =section=                      | VARCHAR<255> | section of main plot containing EI                                                                                            |
| =cc_pre=                       | VARCHAR<255> | cover crop preceding main crop                                                                                                |
| =cc_pre_method=                | VARCHAR<255> | planting method of =cc_pre=                                                                                                     |
| =cc_post=                      | VARCHAR<255> | cover crop planted after, or interseeded in main crop                                                                         |
| =cc_post_method=               | VARCHAR<255> | planting method of =cc_post=                                                                                                    |
| =stability_coef=               | FLOAT<8>     | stand alone soil "stability" coefficient;                                                                                     |
| =stability_coef_normalized=    | FLOAT<8>     | soil "stability" coefficient min/max normalized using just the SI plots; based on =stability_coef=                              |
| =living_cover_coef=            | FLOAT<8>     | stand alone soil "living cover (or roots)" coefficient;                                                                       |
| =living_cover_coef_normalized= | FLOAT<8>     | living cover (or roots) coefficient min/max normalized using only SI plots; based on unadjusted system score for living cover |
| =rci_coef=                     | FLOAT<8>     | Rotational Complexity Index (RCI = number of species*rotation length); see Bowles et al. 2020                                 |
| =rci_coef_normalized=          | FLOAT<8>     | RCI min/max normalized using only SI plots; based on unadjusted RCI (i.e., rci)                                               |
| =richness_coef=                | FLOAT<8>     | richness stand alone coefficients                                                                                             |
| =richness_coef_normalized=     | FLOAT<8>     | richness min/max normalized using only SI plots; based on unadjusted system score                                             |
| =cows_coef=                    | FLOAT<8>     | degree of livestock integration taking presence/absence of animals into account as well as livestock manrue;                  |
| =cows_coef_normalized=         | FLOAT<8>     | cows min/max normalized using only SI plots; based on unadjusted systems score                                                |
| =pox=                          | FLOAT<8>     | POxC, mg C oxidized per kg soil                                                                                               |
| =pom=                          | FLOAT<8>     | POM-C, fraction of total C                                                                                                    |
| =nit=                          | FLOAT<8>     | Total N, %                                                                                                                    |
| =c=                            | FLOAT<8>     | Total C, %                                                                                                                    |
| =microbial_biomass=            | FLOAT<8>     | Microbial biomass, nmol/g soil                                                                                                |
| =act_abundance=                | FLOAT<8>     | Actinobacteria abundance, nmol/g soil (16:0 10 methyl + 17:0 10 methyl + 18:0 10 methyl)                                      |
| =amf_abundance=                | FLOAT<8>     | AMF, nmol/g soil  (16:1 w5c), in agricultural soils this may contain bacterial components                                     |
| =fun_abundance=                | FLOAT<8>     | Fungi abundance, nmol/g soil (18:1 w9c + 18:2 w6c), weighted toward saprophytic fungi, not mycorrhizal fungi                  |
| =gram_negative_abundance=      | FLOAT<8>     | Gram negative bacteria abundance, nmol/g soil                                                                                 |
| =gram_positive_abundance=      | FLOAT<8>     | Gram positive bacteria abundance, nmol/g soil                                                                                 |
| =protist_abundance=            | FLOAT<8>     | Protists, nmol/g soil  (20:4 w6c)                                                                                             |
| =bacteria_abundance=           | FLOAT<8>     | Bacteria, nmol/g soil                                                                                                         |
| =act_percent=                  | FLOAT<8>     | Actinobacteria,mol%  (16:0 10 methyl + 17:0 10 methyl + 18:0 10 methyl)                                                       |
| =amf_percent=                  | FLOAT<8>     | AMF, mol% (16:1 w5c)                                                                                                          |
| =fun_percent=                  | FLOAT<8>     | Fungi, mol% (18:1 w9c + 18:2 w6c)                                                                                             |
| =gram_negative_percent=        | FLOAT<8>     | Gram negative bacteria abundance,mol%                                                                                         |
| =gram_positive_percent=        | FLOAT<8>     | Gram positive bacteria abundance, mol%                                                                                        |
| =protist_percent=              | FLOAT<8>     | Protists, mol% (20:4 w6c)                                                                                                     |
| =bacteria_percent=             | FLOAT<8>     | Bacteria, mol%                                                                                                                |
**** Data Details
- =no_till_stability_coef= ::
  1/(1+system score), simple inverse of tillage with correction for values <1
- =living_cover_coef= ::
  1/(1+system score), simple inverse with correction for values <1
- =richness_coef= ::
  =richness_coef = 1-(1/score)=
- =cows_coef= ::
  adding 1 in denominator to account for zeros =cows_coef = 1-1/(score+1)=
* Views Documentation
** WICST Schema
*** Pasture Summary
* Database Maintenance
** Style Guide
** Design Guide
* Front End Maintenance
** Data Entry
Data entry is for entering data into the database. It is designed around a well curated Excel spreadsheet with as many checks implemented so that
1. data is as consistent as possible with database schema
2. mistakes can be easily spotted by visual review

There is 1 excel spreadsheet for data entry for each project, to match how the schemas are separated. This means that front end maintenance will have to update each one of the data entry sheets manually if there are changes to the schema that affect mutiple projects. Yearly entry can thus be a copy of their respective project sheets.
*** Copy and pasting a table from master
1. Make needed changes in =wicst_upload_example_master.xlsx=, i.e. create a new entry sheet for canopeo observations
2. Copy the table + header row, with select cell in the table, Cmd + A, Cmd + A, Cmd + C
   - the first Cmd + A selects only the rows without the headers
3. Any formula references will carry the sheet context with it, see below ([[fig:workbook_reference_in_formula][link]]), these need to be deleted manually in the formula bar.
   - if all workbook links are successfully deleted, the icon "workbook links" in the data section will be greyed out

    #+ATTR_ODT: :width 800 :height 300 :anchor page
    #+NAME: fig:workbook_reference_in_formula
    #+CAPTION: Here we copied a new sheet from master into an entry sheet for 2024, but copied sheets may have sheet references in the formulas to manually delete.
    [[file:img/frontend_workbook_reference.png]]
4. Data Validation needs to be manually updated with the correct references as well. The validation menu is what gives each box the dropdown menu.

    #+ATTR_ODT: :width 15 :height 10 :anchor paragraph
    #+NAME: fig:validation_location
    #+CAPTION: Data > Data Validation. This is how the drop down menus in excel are created
    [[file:img/frontend_validation_location.png]]

    #+ATTR_ODT: :width 15 :height 10 :anchor paragraph
    #+NAME: fig:validation_location
    #+CAPTION: Select "List" from the settings and select the range that the possible values for this cell can come from. Here I have the selection extended past the last item so that any items added in the future will show up in the drop down without additional changing of the data validation. A blank will show up as a valid option.
    [[file:img/frontend_validation_settings.png]]

    #+ATTR_ODT: :width 15 :height 10 :anchor paragraph
    #+NAME: fig:validation_location
    #+CAPTION: Information, error, or warning. Generally the message I give is informational to alert the user of a possible misentry, but not stop them from entering the data.
    [[file:img/frontend_validation_error.png]]
5. Conditional Validation rules also need to be updated manually depending on what is considered "invalid input". The red strikeout text makes it easier to visually verify that data is entered correctly.
    - Additionally, I have found that it is easier to ensure the data validation rules do not get overwritten. When excel sheets are locked and cells are formatted to be locked, there is no category to ensure data validation rules don't disappear after a copy and paste. With data validation, the safest paste is a "special paste" with values only. There is however, a category for formatting of the cells to be locked, so crude copy and paste will not affect the formatting rules.  Hence data validation by formatting appears to be more stable.

    #+ATTR_ODT: :width 15 :height 10 :anchor paragraph
    #+NAME: fig:validation_location
    #+CAPTION: Rules for red strikeout text are "classic" style that "Use a formula to determine which cells to format" with a custom styling.
    [[file:img/frontend_conditional_location.png]]
*** Reviewing data for correctness
1. Data Validation Rules
   - depending on the "informational -> warning -> error" level of data validation error, there still may be some incorrect values allowed when the validation level is not error. Excel will try to help with a little green corner marker, but unfortunately these do not show up unless the sheet is unlocked. You may also use the "Data > Data Validation > Circle Invalid Data" option to identify deviants.

    #+ATTR_ODT: :width 12 :height 8 :anchor paragraph
    #+NAME: fig:validation_location
    #+CAPTION: Here is a copy and paste error, in which excel shows a little green triangle for data entry errors. This is only for /unlocked/ data sheets.
    [[file:img/frontend_validation_notification.png]]
2. Conditional Formatting
   - incorrect input should be highlighted red, but this is not yet implemented for all columns/entry as it is quite annoying to maintain with lots of manual formula editing.

Here is a list of additional common errors to look for:
- data is entered into the correct sheet for each experiment
- data is not copy and pasted in the correct cells
* Middleware Maintenance
* Bibliography                                                      :soil_archive:
#+print_bibliography:
